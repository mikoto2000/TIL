version: '3'

services:
  dev:
    build:
      context: ./.devcontainer/dockerfile/dev
    ports:
      - 8080:8080
    volumes:
      # プロジェクトディレクトリ
      - ./:/work
      - maven_data:/home/vscode/.m2
    environment:
      DB_URL: jdbc:mysql://mysql:3306/public
      DB_USER: admin
      DB_PASSWORD: password
      TZ: Asia/Tokyo
    command: sleep infinity
    working_dir: /work
    user: vscode
  mysql:
    image: mysql:8.1
    restart: always
    volumes:
      # MySQL データディレクトリ
      - mysql_data:/var/lib/mysql
      - .devcontainer/initdb.d:/docker-entrypoint-initdb.d
    environment:
      MYSQL_DATABASE: public
      MYSQL_USER: admin
      MYSQL_PASSWORD: password
      MYSQL_ROOT_PASSWORD: password
      TZ: Asia/Tokyo
    ports:
      - 0.0.0.0:3306:3306
    command: >
      mysqld
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --default-time-zone=Asia/Tokyo

volumes:
  mysql_data:
  maven_data:
    external: true

